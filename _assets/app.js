var x="x-action",L=new MutationObserver(t=>{for(let e of t){if(e.type==="attribute"){b(e.target);continue}if(e.type==="childList"){for(let o of e.removedNodes)o.$binds&&(o.$binds=null);for(let o of e.addedNodes)o.nodeType===Node.ELEMENT_NODE&&b(o);continue}}});document.readyState==="complete"?E():document.addEventListener("DOMContentLoaded",E,{once:!0});function E(){let t=document.body;L.observe(t,{childList:!0,subtree:!0,attributeFilter:[x]});for(let e of t.querySelectorAll(`[${x}]`))b(e)}function b(t){if(!t.hasAttribute(x))return;let e=t.getAttribute(x).split(/\s+/),o=t.$binds={};for(let n of e){let r=n.lastIndexOf(":"),i=Math.max(0,n.lastIndexOf("#"))||n.length,a=n.slice(0,r),c=n.slice(r+1,i),l=n.slice(i+1)||"handleEvent";if(!c.includes("-"))continue;let d=t.closest(c);if(!d)continue;let s=customElements.get(c)?d:c;t.addEventListener(a,I);let h=o[a];if(!h){o[a]=C(s,l);continue}for(;h.next;)h=h.next;h.next=C(s,l)}}function I(t){let e=t.currentTarget,o=e.$binds;if(!o)return;let n=o[t.type];for(;n;){let r=n.method,i=n.target;if(typeof i=="string"){if(!customElements.get(i)){n=n.next;continue}i=n.target=e.closest(i)}i[r]&&i[r](t),n=n.next}}function C(t,e){return{target:t,method:e,next:null}}function u(t,e){return t.querySelector(`[x-target~='${t.localName}.${e}']`)||null}var{default:f}=await import("./data.js"),{default:S}=await import("./commithash.js"),k=class extends HTMLElement{searchField=u(this,"searchField");autocompleteContainer=u(this,"autocompleteContainer");augmentsContainer=u(this,"augmentsContainer");displayContainer=u(this,"displayContainer");commitHash=u(this,"commitHash");searchResults=[];searchIndex=-1;searchInitialized=!1;searchDirty=!1;augments;connectedCallback(){let o=new URLSearchParams(location.search).get("augments")?.split(",")||[];this.augments=o,this.commitHash.textContent=S,this.calculate(),this._initializeSearch()}calculate(){let e=this.augments,{scores:o,unknowns:n}=A(e),r=Object.keys(o);for(let l=0,d=r.length;l<d;l++){let s=r[l],h=n[s],p=o[s],m=/pot|resist|crit|drop/.test(s)?`${D(p,2).toFixed(2)}%`:p,g=document.getElementById(s),y=g.previousElementSibling,w=!!(p||h);y.classList.toggle("highlight",w),g.classList.toggle("highlight",w),g.textContent=`${m}${h?" ?":""}`}let i=this.augmentsContainer,a=[...i.childNodes],c=0;for(;c<e.length;c++){let l=e[c],d=f[l],s=a[c];if(d){if(s){s.textContent=d.name,s.dataset.value=l;continue}s=document.createElement("li"),s.textContent=d.name,s.dataset.value=l,s.tabIndex=0,s.setAttribute("x-action","click:x-app#handleAugmentClick keydown:x-app#handleAugmentKeydown"),i.appendChild(s)}}for(;c<a.length;c++)a[c].remove()}handleAugmentClick(e){let n=e.target.dataset.value,r=this.augments,i=r.indexOf(n);i!==-1&&(r.splice(i,1),this._replaceUrl(),this.calculate(),this.searchDirty=!0)}handleAugmentKeydown(e){e.key==="Enter"&&this.handleAugmentClick(e)}handleSearchKeydown(e){let o=e.currentTarget,n=e.key,r=this.searchResults,i=this.searchIndex,a=n==="ArrowUp",c=n==="ArrowDown",l=n==="Enter";if(n==="Escape")o.parentNode.classList.add("escaped");else if(l)i>-1&&r[i].click();else if(a||c){e.preventDefault();let s=r.length,p=i+(a?-1:1);if(p<0?p=s-1:p>=s&&(p=s?0:-1),i!==-1&&r[i].classList.remove("selected"),p!==-1){let m=r[p];m.classList.add("selected"),m.scrollIntoView({block:"nearest"})}this.searchIndex=p}}handleSearchInput(e){let o=this.searchDirty,n=e.target,r=n.parentNode,i=n.dataset.query,a=n.value.trim().toLowerCase();if(i===a&&!o)return;let c=this.autocompleteContainer,l=!o&&i&&a.startsWith(i)?this.searchResults:c.childNodes,d=[];r.classList.remove("escaped");for(let h=0,p=l.length;h<p;h++){let m=l[h],g=m.dataset,y=a&&!this.augments.includes(g.value)&&m.textContent.toLowerCase().includes(a);m.style.setProperty("display",y?"":"none"),y&&d.push(m)}n.dataset.query=a,c.classList.toggle("empty",!d.length);let s=this.searchIndex;s!==-1&&this.searchResults[s].classList.remove("selected"),this.searchIndex=-1,this.searchResults=d}handleSearchFocusIn(e){e.currentTarget.classList.remove("escaped"),this.searchDirty&&(this.handleSearchInput(e),this.searchDirty=!1)}handleSearchItemClick(e){let o=e.target,n=o.dataset.value,r=this.searchResults,i=r.indexOf(o);o.style.setProperty("display","none"),o.classList.remove("selected");let a=!1;if(i!==-1&&(r.splice(i,1),(a=!r.length)&&this.autocompleteContainer.classList.add("empty")),this.searchIndex=a?-1:0,this.searchField.focus(),!a){let l=r[0];l.classList.add("selected"),l.scrollIntoView({block:"nearest"})}this.augments.push(n),this._replaceUrl(),this.calculate()}_initializeSearch(){if(this.searchInitialized)return;this.searchInitialized=!0;let e=this.autocompleteContainer,o=Object.keys(f);for(let n=0,r=o.length;n<r;n++){let i=o[n],a=f[i],c=document.createElement("li");c.style.setProperty("display","none"),c.setAttribute("x-action","click:x-app#handleSearchItemClick"),c.textContent=`${a.name}`,c.dataset.bp=a.bp||"0",c.dataset.value=i,c.dataset.idx=n,e.appendChild(c)}}_replaceUrl(){let e=this.augments.join(",");history.replaceState(null,"",e?`?augments=${e}`:"?")}};customElements.define("x-app",k);function A(t){let e=$(0),o=$(!1);for(let n=0,r=t.length;n<r;n++){let i=t[n];if(!(i in f))continue;let a=f[i],c=Object.keys(a);for(let l=0,d=c.length;l<d;l++){let s=c[l],h=a[s];s!=="name"&&(h==="?"?o[s]=!0:s==="mel_pot"||s==="rng_pot"||s==="tec_pot"||s==="pot_floor"||s===s==="dmg_resist"?e[s]=(e[s]||1)*(1+h/100):e[s]+=h)}}return{scores:e,unknowns:o}}function $(t){return{bp:t,hp:t,pp:t,exp_grind:t,mel_pot:t,rng_pot:t,tec_pot:t,pot_floor:t,dmg_resist:t,burn_resist:t,freeze_resist:t,shock_resist:t,blind_resist:t,panic_resist:t,poison_resist:t,pain_resist:t,all_resist:t,low_temp_resist:t,fire_pot:t,ice_pot:t,lightning_pot:t,wind_pot:t,light_pot:t,dark_pot:t,daytime_pot:t,nighttime_pot:t,seasonal_pot:t,seasonal_crit:t,seasonal_drop:t}}function D(t,e){let o=10**e;return Math.floor((t+Number.EPSILON)*o)/o}
//# sourceMappingURL=app.js.map
