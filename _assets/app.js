var y="x-action",I=new MutationObserver(e=>{for(let t of e){if(t.type==="attribute"){b(t.target);continue}if(t.type==="childList"){for(let s of t.removedNodes)s.$binds&&(s.$binds=null);for(let s of t.addedNodes)s.nodeType===Node.ELEMENT_NODE&&b(s);continue}}});document.readyState==="complete"?E():document.addEventListener("DOMContentLoaded",E,{once:!0});function E(){let e=document.body;I.observe(e,{childList:!0,subtree:!0,attributeFilter:[y]});for(let t of e.querySelectorAll(`[${y}]`))b(t)}function b(e){if(!e.hasAttribute(y))return;let t=e.getAttribute(y).split(/\s+/),s=e.$binds={};for(let n of t){let r=n.lastIndexOf(":"),i=Math.max(0,n.lastIndexOf("#"))||n.length,c=n.slice(0,r),a=n.slice(r+1,i),l=n.slice(i+1)||"handleEvent";if(!a.includes("-"))continue;let p=e.closest(a);if(!p)continue;let o=customElements.get(a)?p:a;e.addEventListener(c,A);let d=s[c];if(!d){s[c]=C(o,l);continue}for(;d.next;)d=d.next;d.next=C(o,l)}}function A(e){let t=e.currentTarget,s=t.$binds;if(!s)return;let n=s[e.type];for(;n;){let r=n.method,i=n.target;if(typeof i=="string"){if(!customElements.get(i)){n=n.next;continue}i=n.target=t.closest(i)}i[r]&&i[r](e),n=n.next}}function C(e,t){return{target:e,method:t,next:null}}function g(e,t){return e.querySelector(`[x-target~='${e.localName}.${t}']`)||null}var{default:x}=await import("./data.js"),{default:v}=await import("./commithash.js"),S=new Set(["mel_pot","rng_pot","tec_pot","pot_floor","dmg_resist"]),w=class extends HTMLElement{searchField=g(this,"searchField");autocompleteContainer=g(this,"autocompleteContainer");augmentsContainer=g(this,"augmentsContainer");displayContainer=g(this,"displayContainer");commitHash=g(this,"commitHash");searchResults=[];searchIndex=-1;searchInitialized=!1;searchDirty=!1;augments;connectedCallback(){let s=new URLSearchParams(location.search).get("augments")?.split(",")||[];this.augments=s,this.commitHash.textContent=v,this.calculate(),this._initializeSearch()}calculate(){let t=this.augments,{scores:s,unknowns:n}=N(t),r=Object.keys(s);for(let l=0,p=r.length;l<p;l++){let o=r[l],d=n[o],h=s[o],m=h;S.has(o)?m=$(h,3).toFixed(3):/pot|resist|crit|drop/.test(o)&&(m=$(h,2).toFixed(2)+"%");let u=document.getElementById(o),f=u.previousElementSibling,k=!!(h||d);f.classList.toggle("highlight",k),u.classList.toggle("highlight",k),u.textContent=`${m}${d?" ?":""}`}let i=this.augmentsContainer,c=[...i.childNodes],a=0;for(;a<t.length;a++){let l=t[a],p=x[l],o=c[a];if(p){if(o){o.textContent=p.name,o.dataset.value=l;continue}o=document.createElement("li"),o.textContent=p.name,o.dataset.value=l,o.tabIndex=0,o.setAttribute("x-action","click:x-app#handleAugmentClick keydown:x-app#handleAugmentKeydown"),i.appendChild(o)}}for(;a<c.length;a++)c[a].remove()}handleAugmentClick(t){let n=t.target.dataset.value,r=this.augments,i=r.indexOf(n);i!==-1&&(r.splice(i,1),this._replaceUrl(),this.calculate(),this.searchDirty=!0)}handleAugmentKeydown(t){t.key==="Enter"&&this.handleAugmentClick(t)}handleSearchKeydown(t){let s=t.currentTarget,n=t.key,r=this.searchResults,i=this.searchIndex,c=n==="ArrowUp",a=n==="ArrowDown",l=n==="Enter";if(n==="Escape")s.parentNode.classList.add("escaped");else if(l)i>-1&&r[i].click();else if(c||a){t.preventDefault();let o=r.length,h=i+(c?-1:1);if(h<0?h=o-1:h>=o&&(h=o?0:-1),i!==-1&&r[i].classList.remove("selected"),h!==-1){let m=r[h];m.classList.add("selected"),m.scrollIntoView({block:"nearest"})}this.searchIndex=h}}handleSearchInput(t){let s=this.searchDirty,n=t.target,r=n.parentNode,i=n.dataset.query,c=n.value.trim().toLowerCase();if(i===c&&!s)return;let a=this.autocompleteContainer,l=!s&&i&&c.startsWith(i)?this.searchResults:a.childNodes,p=[];r.classList.remove("escaped");for(let d=0,h=l.length;d<h;d++){let m=l[d],u=m.dataset,f=c&&!this.augments.includes(u.value)&&m.textContent.toLowerCase().includes(c);m.style.setProperty("display",f?"":"none"),f&&p.push(m)}n.dataset.query=c,a.classList.toggle("empty",!p.length);let o=this.searchIndex;o!==-1&&this.searchResults[o].classList.remove("selected"),this.searchIndex=-1,this.searchResults=p}handleSearchFocusIn(t){t.currentTarget.classList.remove("escaped"),this.searchDirty&&(this.handleSearchInput(t),this.searchDirty=!1)}handleSearchItemClick(t){let s=t.target,n=s.dataset.value,r=this.searchResults,i=r.indexOf(s);s.style.setProperty("display","none"),s.classList.remove("selected");let c=!1;if(i!==-1&&(r.splice(i,1),(c=!r.length)&&this.autocompleteContainer.classList.add("empty")),this.searchIndex=c?-1:0,this.searchField.focus(),!c){let l=r[0];l.classList.add("selected"),l.scrollIntoView({block:"nearest"})}this.augments.push(n),this._replaceUrl(),this.calculate()}_initializeSearch(){if(this.searchInitialized)return;this.searchInitialized=!0;let t=this.autocompleteContainer,s=Object.keys(x);for(let n=0,r=s.length;n<r;n++){let i=s[n],c=x[i],a=document.createElement("li");a.style.setProperty("display","none"),a.setAttribute("x-action","click:x-app#handleSearchItemClick"),a.textContent=`${c.name}`,a.dataset.bp=c.bp||"0",a.dataset.value=i,a.dataset.idx=n,t.appendChild(a)}}_replaceUrl(){let t=this.augments.join(",");history.replaceState(null,"",t?`?augments=${t}`:"?")}};customElements.define("x-app",w);function N(e){let t=L(0),s=L(!1);for(let n=0,r=e.length;n<r;n++){let i=e[n];if(!(i in x))continue;let c=x[i],a=Object.keys(c);for(let l=0,p=a.length;l<p;l++){let o=a[l],d=c[o];o!=="name"&&(d==="?"?s[o]=!0:S.has(o)?t[o]=(t[o]||1)*(1+d/100):t[o]+=d)}}return{scores:t,unknowns:s}}function L(e){return{bp:e,hp:e,pp:e,exp_grind:e,mel_pot:e,rng_pot:e,tec_pot:e,pot_floor:e,dmg_resist:e,burn_resist:e,freeze_resist:e,shock_resist:e,blind_resist:e,panic_resist:e,poison_resist:e,pain_resist:e,all_resist:e,low_temp_resist:e,fire_pot:e,ice_pot:e,lightning_pot:e,wind_pot:e,light_pot:e,dark_pot:e,daytime_pot:e,nighttime_pot:e,seasonal_pot:e,seasonal_crit:e,seasonal_drop:e}}function $(e,t){let s=10**t;return Math.floor((e+Number.EPSILON)*s)/s}
//# sourceMappingURL=app.js.map
