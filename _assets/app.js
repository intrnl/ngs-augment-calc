var x="x-action",I=new MutationObserver(t=>{for(let e of t){if(e.type==="attribute"){b(e.target);continue}if(e.type==="childList"){for(let s of e.removedNodes)s.$binds&&(s.$binds=null);for(let s of e.addedNodes)s.nodeType===Node.ELEMENT_NODE&&b(s);continue}}});document.readyState==="complete"?w():document.addEventListener("DOMContentLoaded",w,{once:!0});function w(){let t=document.body;I.observe(t,{childList:!0,subtree:!0,attributeFilter:[x]});for(let e of t.querySelectorAll(`[${x}]`))b(e)}function b(t){if(!t.hasAttribute(x))return;let e=t.getAttribute(x).split(/\s+/),s=t.$binds={};for(let n of e){let r=n.lastIndexOf(":"),o=Math.max(0,n.lastIndexOf("#"))||n.length,a=n.slice(0,r),c=n.slice(r+1,o),l=n.slice(o+1)||"handleEvent";if(!c.includes("-"))continue;let d=t.closest(c);if(!d)continue;let i=customElements.get(c)?d:c;t.addEventListener(a,L);let h=s[a];if(!h){s[a]=C(i,l);continue}for(;h.next;)h=h.next;h.next=C(i,l)}}function L(t){let e=t.currentTarget,s=e.$binds;if(!s)return;let n=s[t.type];for(;n;){let r=n.method,o=n.target;if(typeof o=="string"){if(!customElements.get(o)){n=n.next;continue}o=n.target=e.closest(o)}o[r]&&o[r](t),n=n.next}}function C(t,e){return{target:t,method:e,next:null}}function g(t,e){return t.querySelector(`[x-target~='${t.localName}.${e}']`)||null}var{default:f}=await import("./data-JZYYXS53.js"),k=class extends HTMLElement{searchField=g(this,"searchField");autocompleteContainer=g(this,"autocompleteContainer");augmentsContainer=g(this,"augmentsContainer");displayContainer=g(this,"displayContainer");commitHash=g(this,"commitHash");searchResults=[];searchIndex=-1;searchInitialized=!1;searchDirty=!1;augments;connectedCallback(){let s=new URLSearchParams(location.search).get("augments")?.split(",")||[];this.augments=s,this.commitHash.textContent="4fd5f0",this.calculate(),this._initializeSearch()}calculate(){let e=this.augments,{scores:s,unknowns:n}=S(e),r=Object.keys(s);for(let l=0,d=r.length;l<d;l++){let i=r[l],h=n[i],p=s[i],m=/pot|resist|crit|drop/.test(i)?`${p.toFixed(2)}%`:p,u=document.getElementById(i),y=u.previousElementSibling,E=!!(p||h);y.classList.toggle("highlight",E),u.classList.toggle("highlight",E),u.textContent=`${m}${h?" ?":""}`}let o=this.augmentsContainer,a=[...o.childNodes],c=0;for(;c<e.length;c++){let l=e[c],d=f[l],i=a[c];if(!!d){if(i){i.textContent=d.name,i.dataset.value=l;continue}i=document.createElement("li"),i.textContent=d.name,i.dataset.value=l,i.tabIndex=0,i.setAttribute("x-action","click:x-app#handleAugmentClick keydown:x-app#handleAugmentKeydown"),o.appendChild(i)}}for(;c<a.length;c++)a[c].remove()}handleAugmentClick(e){let n=e.target.dataset.value,r=this.augments,o=r.indexOf(n);o!==-1&&(r.splice(o,1),this._replaceUrl(),this.calculate(),this.searchDirty=!0)}handleAugmentKeydown(e){e.key==="Enter"&&this.handleAugmentClick(e)}handleSearchKeydown(e){let s=e.currentTarget,n=e.key,r=this.searchResults,o=this.searchIndex,a=n==="ArrowUp",c=n==="ArrowDown",l=n==="Enter";if(n==="Escape")s.parentNode.classList.add("escaped");else if(l)o>-1&&r[o].click();else if(a||c){e.preventDefault();let i=r.length,p=o+(a?-1:1);if(p<0?p=i-1:p>=i&&(p=i?0:-1),o!==-1&&r[o].classList.remove("selected"),p!==-1){let m=r[p];m.classList.add("selected"),m.scrollIntoView({block:"nearest"})}this.searchIndex=p}}handleSearchInput(e){let s=this.searchDirty,n=e.target,r=n.parentNode,o=n.dataset.query,a=n.value.trim().toLowerCase();if(o===a&&!s)return;let c=this.autocompleteContainer,l=!s&&o&&a.startsWith(o)?this.searchResults:c.childNodes,d=[];r.classList.remove("escaped");for(let h=0,p=l.length;h<p;h++){let m=l[h],u=m.dataset,y=a&&!this.augments.includes(u.value)&&m.textContent.toLowerCase().includes(a);m.style.setProperty("display",y?"":"none"),y&&d.push(m)}n.dataset.query=a,c.classList.toggle("empty",!d.length);let i=this.searchIndex;i!==-1&&this.searchResults[i].classList.remove("selected"),this.searchIndex=-1,this.searchResults=d}handleSearchFocusIn(e){e.currentTarget.classList.remove("escaped"),this.searchDirty&&(this.handleSearchInput(e),this.searchDirty=!1)}handleSearchItemClick(e){let s=e.target,n=s.dataset.value,r=this.searchResults,o=r.indexOf(s);s.style.setProperty("display","none"),s.classList.remove("selected");let a=!1;if(o!==-1&&(r.splice(o,1),(a=!r.length)&&this.autocompleteContainer.classList.add("empty")),this.searchIndex=a?-1:0,this.searchField.focus(),!a){let l=r[0];l.classList.add("selected"),l.scrollIntoView({block:"nearest"})}this.augments.push(n),this._replaceUrl(),this.calculate()}_initializeSearch(){if(this.searchInitialized)return;this.searchInitialized=!0;let e=this.autocompleteContainer,s=Object.keys(f);for(let n=0,r=s.length;n<r;n++){let o=s[n],a=f[o],c=document.createElement("li");c.style.setProperty("display","none"),c.setAttribute("x-action","click:x-app#handleSearchItemClick"),c.textContent=`${a.name}`,c.dataset.bp=a.bp||"0",c.dataset.value=o,c.dataset.idx=n,e.appendChild(c)}}_replaceUrl(){let e=this.augments.join(",");history.replaceState(null,"",e?`?augments=${e}`:"?")}};customElements.define("x-app",k);function S(t){let e=$(0),s=$(!1);for(let n=0,r=t.length;n<r;n++){let o=t[n];if(!(o in f))continue;let a=f[o],c=Object.keys(a);for(let l=0,d=c.length;l<d;l++){let i=c[l],h=a[i];i!=="name"&&(h==="?"?s[i]=!0:e[i]+=h)}}return{scores:e,unknowns:s}}function $(t){return{bp:t,hp:t,pp:t,exp_grind:t,mel_pot:t,rng_pot:t,tec_pot:t,pot_floor:t,dmg_resist:t,burn_resist:t,freeze_resist:t,shock_resist:t,blind_resist:t,panic_resist:t,poison_resist:t,pain_resist:t,all_resist:t,low_temp_resist:t,fire_pot:t,ice_pot:t,lightning_pot:t,wind_pot:t,light_pot:t,dark_pot:t,daytime_pot:t,nighttime_pot:t,seasonal_pot:t,seasonal_crit:t,seasonal_drop:t}}
//# sourceMappingURL=app.js.map
