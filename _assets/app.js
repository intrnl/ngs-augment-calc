var f="x-action",C=new MutationObserver(t=>{for(let e of t){if(e.type==="attribute"){y(e.target);continue}if(e.type==="childList"){for(let o of e.removedNodes)o.$binds&&(o.$binds=null);for(let o of e.addedNodes)o.nodeType===Node.ELEMENT_NODE&&y(o);continue}}});document.readyState==="complete"?b():document.addEventListener("DOMContentLoaded",b,{once:!0});function b(){let t=document.body;C.observe(t,{childList:!0,subtree:!0,attributeFilter:[f]});for(let e of t.querySelectorAll(`[${f}]`))y(e)}function y(t){if(!t.hasAttribute(f))return;let e=t.getAttribute(f).split(/\s+/),o=t.$binds={};for(let n of e){let i=n.lastIndexOf(":"),s=Math.max(0,n.lastIndexOf("#"))||n.length,c=n.slice(0,i),r=n.slice(i+1,s),l=n.slice(s+1)||"handleEvent";if(!r.includes("-")){DEV&&console.warn(`cannot bind ${c} event to ${r} because it is not a custom element`);continue}let a=t.closest(r);if(!a){DEV&&console.warn(`cannot bind ${c} event to ${r}#${l} because ${r} is not in the ancestor tree`,t);continue}let d=customElements.get(r)?a:r;t.addEventListener(c,k);let h=o[c];if(!h){o[c]=E(d,l);continue}for(;h.next;)h=h.next;h.next=E(d,l)}}function k(t){let e=t.currentTarget,o=e.$binds;if(!o)return;let n=o[t.type];for(;n;){let i=n.method,s=n.target;if(typeof s=="string"){if(!customElements.get(s)){DEV&&console.warn(`cannot fire ${t.type} event for ${s} because the controller is still not present.`,e),n=n.next;continue}s=n.target=e.closest(s)}s[i]?s[i](t):DEV&&console.warn(`cannot fire ${t.type} event for ${s.localName}#${i} because it does not exist.`,e),n=n.next}}function E(t,e){return{target:t,method:e,next:null}}function u(t,e){return t.querySelector(`[x-target~='${t.localName}.${e}']`)||null}var{default:g}=await import("/_assets/data.js"),x=class extends HTMLElement{searchField=u(this,"searchField");autocompleteContainer=u(this,"autocompleteContainer");augmentsContainer=u(this,"augmentsContainer");displayContainer=u(this,"displayContainer");commitHash=u(this,"commitHash");searchResults=[];searchIndex=-1;searchInitialized=!1;searchDirty=!1;augments;connectedCallback(){let o=new URLSearchParams(location.search).get("augments")?.split(",")||[];this.augments=o,this.commitHash.textContent="63fe8b",this.calculate(),this._initializeSearch()}calculate(){let e=this.augments,{scores:o,unknowns:n}=$(e);for(let r in o){let l=n[r],a=o[r],d=/pot|resist|crit|drop/.test(r)?`${a.toFixed(2)}%`:a,h=document.getElementById(r),p=h.previousElementSibling,m=a||l;p.classList.toggle("highlight",m),h.classList.toggle("highlight",m),h.textContent=`${d}${l?" ?":""}`}let i=this.augmentsContainer,s=[...i.childNodes],c=0;for(;c<e.length;c++){let r=e[c],l=g[r],a=s[c];if(!!l){if(a){a.textContent=l.name,a.dataset.value=r;continue}a=document.createElement("li"),a.textContent=l.name,a.dataset.value=r,a.tabIndex=0,a.setAttribute("x-action","click:x-app#handleAugmentClick keydown:x-app#handleAugmentKeydown"),i.appendChild(a)}}for(;c<s.length;c++)s[c].remove()}handleAugmentClick(e){let n=e.target.dataset.value,i=this.augments,s=i.indexOf(n);s!==-1&&(i.splice(s,1),this._replaceUrl(),this.calculate(),this.searchDirty=!0)}handleAugmentKeydown(e){e.key==="Enter"&&this.handleAugmentClick(e)}handleSearchKeydown(e){let o=e.currentTarget,n=e.key,i=this.searchResults,s=this.searchIndex,c=n==="ArrowUp",r=n==="ArrowDown",l=n==="Enter";if(n==="Escape")o.parentNode.classList.add("escaped");else if(l)s>-1&&i[s].click();else if(c||r){e.preventDefault();let d=i.length,p=s+(c?-1:1);if(p<0?p=d-1:p>=d&&(p=d?0:-1),s!==-1&&i[s].classList.remove("selected"),p!==-1){let m=i[p];m.classList.add("selected"),m.scrollIntoView({block:"nearest"})}this.searchIndex=p}}handleSearchInput(e){let o=this.searchDirty,n=e.target,i=n.parentNode,s=n.dataset.query,c=n.value.trim().toLowerCase();if(s===c&&!o)return;let r=this.autocompleteContainer,l=!o&&s&&c.startsWith(s)?this.searchResults:r.childNodes,a=[];i.classList.remove("escaped");for(let h of l){let p=h.dataset,m=c&&!this.augments.includes(p.value)&&h.textContent.toLowerCase().includes(c);h.style.setProperty("display",m?"":"none"),m&&a.push(h)}n.dataset.query=c,r.classList.toggle("empty",!a.length);let d=this.searchIndex;d!==-1&&this.searchResults[d].classList.remove("selected"),this.searchIndex=-1,this.searchResults=a}handleSearchFocusIn(e){e.currentTarget.classList.remove("escaped"),this.searchDirty&&(this.handleSearchInput(e),this.searchDirty=!1)}handleSearchItemClick(e){let o=e.target,n=o.dataset.value,i=this.searchResults,s=i.indexOf(o);o.style.setProperty("display","none"),o.classList.remove("selected");let c=!1;if(s!==-1&&(i.splice(s,1),(c=!i.length)&&this.autocompleteContainer.classList.add("empty")),this.searchIndex=c?-1:0,this.searchField.focus(),!c){let l=i[0];l.classList.add("selected"),l.scrollIntoView({block:"nearest"})}this.augments.push(n),this._replaceUrl(),this.calculate()}_initializeSearch(){if(this.searchInitialized)return;this.searchInitialized=!0;let e=this.autocompleteContainer,o=0;for(let n in g){let i=g[n],s=document.createElement("li");s.style.setProperty("display","none"),s.setAttribute("x-action","click:x-app#handleSearchItemClick"),s.textContent=`${i.name}`,s.dataset.bp=i.bp||"0",s.dataset.value=n,s.dataset.idx=o++,e.appendChild(s)}}_replaceUrl(){let e=this.augments.join(",");history.replaceState(null,"",e?`?augments=${e}`:"?")}};customElements.define("x-app",x);function $(t){let e=w(0),o=w(!1);for(let n of t){if(!(n in g))continue;let i=g[n];for(let s in e){if(!(s in i))continue;let c=i[s];c==="?"?o[s]=!0:e[s]+=c}}return{scores:e,unknowns:o}}function w(t){return{bp:t,hp:t,pp:t,exp_grind:t,mel_pot:t,rng_pot:t,tec_pot:t,pot_floor:t,dmg_resist:t,burn_resist:t,freeze_resist:t,shock_resist:t,blind_resist:t,panic_resist:t,poison_resist:t,pain_resist:t,all_resist:t,low_temp_resist:t,fire_pot:t,ice_pot:t,lightning_pot:t,wind_pot:t,light_pot:t,dark_pot:t,daytime_pot:t,nighttime_pot:t,seasonal_pot:t,seasonal_crit:t,seasonal_drop:t}}
//# sourceMappingURL=/_assets/app.js.map
